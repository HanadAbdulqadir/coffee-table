<UserControl x:Class="GameTableManagerPro.Views.DeploymentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewModels="clr-namespace:GameTableManagerPro.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance Type=viewModels:DeploymentViewModel}">
    
    <UserControl.Resources>
        <!-- Styles -->
        <Style x:Key="WizardStepStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF252526"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="10"/>
        </Style>
        
        <Style x:Key="StepHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF007ACC"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        
        <Style x:Key="TableItemStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF1E1E1E"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,5"/>
        </Style>
        
        <Style x:Key="LogEntryStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF1E1E1E"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>
        
        <!-- Converters -->
        <viewModels:LogLevelToBrushConverter x:Key="LogLevelToBrushConverter"/>
    </UserControl.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
                <TextBlock Text="{Binding StatusMessage}" Foreground="White" TextAlignment="Center"/>
            </StackPanel>
        </Border>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">
                <!-- Header -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <TextBlock Text="ðŸš€ Deployment Wizard" Foreground="White" FontSize="24" FontWeight="Bold"/>
                    <Button Content="ðŸ”„ Refresh" Command="{Binding LoadDeploymentDataCommand}" 
                            Margin="20,0,0,0" Padding="10,5" Style="{StaticResource ToolButtonStyle}"/>
                </StackPanel>

                <!-- Wizard Steps -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Step Navigation -->
                    <StackPanel Orientation="Horizontal" Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,20">
                        <Border Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=TableSelection}" 
                                CornerRadius="20" Padding="15,8" Margin="5">
                            <TextBlock Text="1. Select Tables" Foreground="White" FontWeight="Bold"/>
                        </Border>
                        <Border Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=TemplateSelection}" 
                                CornerRadius="20" Padding="15,8" Margin="5">
                            <TextBlock Text="2. Choose Template" Foreground="White" FontWeight="Bold"/>
                        </Border>
                        <Border Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=Review}" 
                                CornerRadius="20" Padding="15,8" Margin="5">
                            <TextBlock Text="3. Review" Foreground="White" FontWeight="Bold"/>
                        </Border>
                        <Border Background="{Binding CurrentStep, Converter={StaticResource StepToBrushConverter}, ConverterParameter=Progress}" 
                                CornerRadius="20" Padding="15,8" Margin="5">
                            <TextBlock Text="4. Progress" Foreground="White" FontWeight="Bold"/>
                        </Border>
                    </StackPanel>

                    <!-- Step Content -->
                    <Border Grid.Row="1" Style="{StaticResource WizardStepStyle}">
                        <ContentControl Content="{Binding CurrentStep}">
                            <ContentControl.Resources>
                                <!-- Table Selection Step -->
                                <DataTemplate DataType="{x:Type viewModels:DeploymentStep}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="SELECT TABLES TO DEPLOY TO" Style="{StaticResource StepHeaderStyle}" Grid.Row="0"/>
                                        
                                        <Grid Grid.Row="1">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Available Tables -->
                                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                <TextBlock Text="Available Tables" Foreground="#FFCCCCCC" FontWeight="Bold" Margin="0,0,0,10"/>
                                                <ScrollViewer MaxHeight="300">
                                                    <ItemsControl ItemsSource="{Binding AvailableTables}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Style="{StaticResource TableItemStyle}">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="Auto"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        
                                                                        <StackPanel>
                                                                            <TextBlock Text="{Binding Hostname}" Foreground="White" FontWeight="Bold"/>
                                                                            <TextBlock Text="{Binding IPAddress}" Foreground="#FFCCCCCC" FontSize="11"/>
                                                                            <TextBlock Text="{Binding Status}" Foreground="{Binding Status, Converter={StaticResource StatusToBrushConverter}}" FontSize="11"/>
                                                                        </StackPanel>
                                                                        
                                                                        <Button Content="âž• Add" Command="{Binding DataContext.AddTableToSelectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                                CommandParameter="{Binding}" Grid.Column="1" Padding="5,2" FontSize="11"
                                                                                Style="{StaticResource ToolButtonStyle}"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </ScrollViewer>
                                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                    <Button Content="Select All" Command="{Binding SelectAllTablesCommand}" 
                                                            Padding="10,5" Margin="0,0,10,0" Style="{StaticResource ToolButtonStyle}"/>
                                                    <Button Content="Clear All" Command="{Binding ClearSelectionCommand}" 
                                                            Padding="10,5" Style="{StaticResource ToolButtonStyle}"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Selection Actions -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0">
                                                <TextBlock Text="â†’" Foreground="#FF007ACC" FontSize="24" HorizontalAlignment="Center"/>
                                            </StackPanel>

                                            <!-- Selected Tables -->
                                            <StackPanel Grid.Column="2" Margin="10,0,0,0">
                                                <TextBlock Text="Selected Tables" Foreground="#FFCCCCCC" FontWeight="Bold" Margin="0,0,0,10"/>
                                                <TextBlock Text="{Binding SelectedTables.Count, StringFormat='{}Tables selected: {0}'}" Foreground="#FF007ACC" Margin="0,0,0,10"/>
                                                <ScrollViewer MaxHeight="300">
                                                    <ItemsControl ItemsSource="{Binding SelectedTables}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Style="{StaticResource TableItemStyle}">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="Auto"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        
                                                                        <StackPanel>
                                                                            <TextBlock Text="{Binding Hostname}" Foreground="White" FontWeight="Bold"/>
                                                                            <TextBlock Text="{Binding IPAddress}" Foreground="#FFCCCCCC" FontSize="11"/>
                                                                        </StackPanel>
                                                                        
                                                                        <Button Content="âŒ Remove" Command="{Binding DataContext.RemoveTableFromSelectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                                CommandParameter="{Binding}" Grid.Column="1" Padding="5,2" FontSize="11"
                                                                                Style="{StaticResource ToolButtonStyle}"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </ScrollViewer>
                                            </StackPanel>
                                        </Grid>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="2" Margin="0,20,0,0">
                                            <Button Content="Next â†’" Command="{Binding NextStepCommand}" 
                                                    Padding="15,8" Background="#FF007ACC" Foreground="White"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>

                                <!-- Template Selection Step -->
                                <DataTemplate DataType="{x:Type viewModels:DeploymentStep}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="CHOOSE DEPLOYMENT TEMPLATE" Style="{StaticResource StepHeaderStyle}" Grid.Row="0"/>
                                        
                                        <ItemsControl ItemsSource="{Binding DeploymentTemplates}" Grid.Row="1">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Style="{StaticResource TableItemStyle}" Margin="0,5">
                                                        <RadioButton GroupName="DeploymentTemplates" 
                                                                    IsChecked="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type Border}}, Mode=TwoWay}"
                                                                    Content="{Binding Name}">
                                                            <RadioButton.Style>
                                                                <Style TargetType="RadioButton">
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                                    <Setter Property="Margin" Value="0,0,0,5"/>
                                                                </Style>
                                                            </RadioButton.Style>
                                                        </RadioButton>
                                                        <TextBlock Text="{Binding Description}" Foreground="#FFCCCCCC" FontSize="12" Margin="20,0,0,0"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="2" Margin="0,20,0,0">
                                            <Button Content="â† Back" Command="{Binding PreviousStepCommand}" 
                                                    Padding="15,8" Margin="0,0,10,0" Style="{StaticResource ToolButtonStyle}"/>
                                            <Button Content="Next â†’" Command="{Binding NextStepCommand}" 
                                                    Padding="15,8" Background="#FF007ACC" Foreground="White"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>

                                <!-- Review Step -->
                                <DataTemplate DataType="{x:Type viewModels:DeploymentStep}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="REVIEW DEPLOYMENT" Style="{StaticResource StepHeaderStyle}" Grid.Row="0"/>
                                        
                                        <StackPanel Grid.Row="1">
                                            <TextBlock Text="Deployment Summary" Foreground="#FFCCCCCC" FontWeight="Bold" Margin="0,0,0,10"/>
                                            <TextBlock Text="{Binding SelectedTemplate.Name, StringFormat='{}Template: {0}'}" Foreground="White" Margin="0,5"/>
                                            <TextBlock Text="{Binding SelectedTemplate.Description}" Foreground="#FFCCCCCC" FontSize="12" Margin="0,0,0,10"/>
                                            <TextBlock Text="{Binding SelectedTables.Count, StringFormat='{}Tables: {0} selected'}" Foreground="White" Margin="0,5"/>
                                            
                                            <Button Content="Test Deployment Script" Command="{Binding TestDeploymentScriptCommand}" 
                                                    Margin="0,20,0,0" Padding="10,5" Style="{StaticResource ToolButtonStyle}"/>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="2" Margin="0,20,0,0">
                                            <Button Content="â† Back" Command="{Binding PreviousStepCommand}" 
                                                    Padding="15,8" Margin="0,0,10,0" Style="{StaticResource ToolButtonStyle}"/>
                                            <Button Content="Start Deployment" Command="{Binding StartDeploymentCommand}" 
                                                    Padding="15,8" Background="#FF4CAF50" Foreground="White" FontWeight="Bold"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>

                                <!-- Progress Step -->
                                <DataTemplate DataType="{x:Type viewModels:DeploymentStep}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="DEPLOYMENT PROGRESS" Style="{StaticResource StepHeaderStyle}" Grid.Row="0"/>
                                        
                                        <!-- Progress Bar -->
                                        <StackPanel Grid.Row="1" Margin="0,0,0,20">
                                            <ProgressBar Value="{Binding DeploymentProgress, Converter={StaticResource ProgressToValueConverter}}" 
                                                        Height="20" Margin="0,0,0,10"/>
                                            <TextBlock Text="{Binding DeploymentProgress}" Foreground="#FF007ACC" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Deployment Logs -->
                                        <StackPanel Grid.Row="2">
                                            <TextBlock Text="Deployment Log" Foreground="#FFCCCCCC" FontWeight="Bold" Margin="0,0,0,10"/>
                                            <ScrollViewer MaxHeight="200">
                                                <ItemsControl ItemsSource="{Binding DeploymentLogs}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Style="{StaticResource LogEntryStyle}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="{Binding Timestamp, StringFormat='{}[HH:mm:ss] '}" Foreground="#FFCCCCCC" FontSize="11"/>
                                                                    <TextBlock Text="{Binding Message}" Foreground="{Binding Level, Converter={StaticResource LogLevelToBrushConverter}}" FontSize="11"/>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="3" Margin="0,20,0,0">
                                            <Button Content="Cancel Deployment" Command="{Binding CancelDeploymentCommand}" 
                                                    Padding="15,8" Background="#FFF44336" Foreground="White" 
                                                    Visibility="{Binding IsDeploymentInProgress, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <Button Content="â† Back to Start" Command="{Binding PreviousStepCommand}" 
                                                    Padding="15,8" Margin="10,0,0,0" Style="{StaticResource ToolButtonStyle}"
                                                    Visibility="{Binding IsDeploymentInProgress, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Reverse}"/>
                                            <Button Content="View History" Command="{Binding ViewDeploymentHistoryCommand}" 
                                                    Padding="15,8" Margin="10,0,0,0" Style="{StaticResource ToolButtonStyle}"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ContentControl.Resources>
                        </ContentControl>
                    </Border>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
